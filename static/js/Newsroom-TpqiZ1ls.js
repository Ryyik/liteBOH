import{r as e,b as a,d as s,z as l,c as t,h as o,f as n,g as i,p as c,v as r,i as d,T as u,F as v,k as m,n as p,t as g,x as w,m as h,D as y,o as f}from"./vue-vendor-DXCnN0d2.js";import{_ as b,U as x,g as k,F as C}from"./ui-components-g-7AJD2c.js";import{g as L,a as _}from"./useNews-B5t5nfPx.js";const I={class:"newsroom-page"},M={class:"filter-bar"},z={class:"container"},T={class:"search-container"},j={class:"search-wrapper"},D={key:0,class:"search-suggestions"},E=["onMousedown"],F={class:"suggestion-title"},S={class:"suggestion-category"},$={class:"filter-container"},A=["onClick","data-category"],B={class:"news-container"},H=["data-category","data-id","onClick"],N={class:"news-image"},U=["srcset"],W=["srcset"],G=["src","alt"],O={class:"news-date"},P={class:"news-content"},V={class:"news-category"},Y={class:"news-title-card"},q={class:"news-excerpt"},J={class:"news-meta"},K={class:"news-author"},Q={class:"author-avatar"},R={class:"modal-header"},X={class:"modal-meta"},Z={id:"modalDate"},ee={id:"modalCategory"},ae={id:"modalAuthor"},se={id:"modalTitle",class:"modal-title"},le={class:"modal-body"},te=["srcset"],oe=["srcset"],ne=["src","alt"],ie=["innerHTML"],ce=b({__name:"Newsroom",setup(b){const ce=e(L()),re=e([...ce.value]),de=e([{label:"全部新闻",value:"all"},{label:"活动公告",value:"event"},{label:"更新日志",value:"update"},{label:"社区动态",value:"community"},{label:"官方通知",value:"announce"}]),ue=e("all"),ve=e(""),me=e(!1),pe=a(()=>{if(!ve.value.trim())return[];const e=ve.value.toLowerCase().trim();return ce.value.filter(a=>a.title.toLowerCase().includes(e)||a.excerpt.toLowerCase().includes(e)||a.author.toLowerCase().includes(e)).slice(0,5)}),ge=()=>{setTimeout(()=>{me.value=!1},200)},we=e(!1),he=e(null),ye=e(null),fe=e([]);let be=null;const xe=()=>{let e=[...ce.value];const a=ve.value.toLowerCase().trim();a?e=e.filter(e=>e.title.toLowerCase().includes(a)||e.excerpt.toLowerCase().includes(a)||e.author.toLowerCase().includes(a)||e.content&&e.content.toLowerCase().includes(a)):"all"!==ue.value&&(e=e.filter(e=>e.category===ue.value)),re.value=e,y(()=>{Me()})},ke=()=>{xe()},Ce=()=>{ve.value="",xe()},Le=()=>{we.value=!1,document.body.style.overflow=""},_e=e=>{const a=new Date(e);return`${a.getFullYear()}/${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}`},Ie=e=>{if(!e||e.startsWith("data:"))return e;const a=e.replace(/\.(png|jpg|jpeg)$/i,".webp");return k(a)},Me=()=>{be&&be.disconnect(),be=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"}),y(()=>{fe.value&&fe.value.forEach(e=>{e&&be.observe(e)})})},ze=e=>{we.value&&e.target.classList.contains("news-modal")&&Le()};return s(()=>{document.body.classList.add("is-loaded"),Me(),document.addEventListener("click",ze)}),l(()=>{be&&be.disconnect(),document.removeEventListener("click",ze)}),(e,a)=>(f(),t("div",I,[o(x),a[7]||(a[7]=n("header",{class:"news-header"},[n("h1",{class:"news-title"},"新闻中心"),n("p",{class:"news-subtitle"},"记录方块之家的每一个重要时刻")],-1)),n("div",M,[n("div",z,[n("div",T,[n("div",j,[a[3]||(a[3]=n("i",{class:"icon-search"},null,-1)),c(n("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>ve.value=e),placeholder:"搜索新闻标题、内容或作者...",onInput:ke,onFocus:a[1]||(a[1]=e=>me.value=!0),onBlur:ge,class:"search-input",autocomplete:"off",name:"news-search-input",spellcheck:"false"},null,544),[[r,ve.value]]),ve.value?(f(),t("button",{key:0,onClick:Ce,class:"clear-search"}," × ")):i("",!0),o(u,{name:"fade"},{default:d(()=>[me.value&&ve.value&&pe.value.length>0?(f(),t("div",D,[(f(!0),t(v,null,m(pe.value,e=>(f(),t("div",{key:e.id,class:"suggestion-item",onMousedown:a=>(e=>{ve.value=e.title,me.value=!1,xe(),window.scrollTo({top:0,behavior:"smooth"})})(e)},[n("span",F,g(e.title),1),n("span",S,g(w(_)(e.category)),1)],40,E))),128))])):i("",!0)]),_:1})])]),n("div",$,[(f(!0),t(v,null,m(de.value,e=>(f(),t("div",{key:e.value,class:p(["filter-tag",{active:ue.value===e.value}]),onClick:a=>{return s=e.value,ue.value=s,void xe();var s},"data-category":e.value},g(e.label),11,A))),128))])])]),n("div",B,[n("div",{class:"news-grid",ref_key:"newsGrid",ref:ye},[(f(!0),t(v,null,m(re.value,(e,s)=>(f(),t("div",{key:e.id,class:"news-card","data-category":e.category,"data-id":e.id,onClick:a=>(e=>{he.value=e,we.value=!0,document.body.style.overflow="hidden"})(e),ref_for:!0,ref_key:"newsCards",ref:fe},[n("div",N,[n("picture",null,[n("source",{srcset:Ie(e.image),type:"image/webp"},null,8,U),n("source",{srcset:w(k)(e.image),type:"image/png"},null,8,W),n("img",{src:w(k)(e.image),alt:e.title,loading:"lazy",decoding:"async",fetchpriority:"low",sizes:"(max-width: 768px) 90vw, (max-width: 1200px) 45vw, 33vw"},null,8,G)]),n("div",O,g(_e(e.date)),1)]),n("div",P,[n("span",V,g(w(_)(e.category)),1),n("h3",Y,g(e.title),1),n("p",q,g(e.excerpt),1),n("div",J,[n("div",K,[n("div",Q,g(e.author.charAt(0)),1),n("span",null,g(e.author),1)]),a[4]||(a[4]=n("span",null,"阅读全文 →",-1))])])],8,H))),128))],512),n("div",{class:p(["no-results",{show:0===re.value.length}])},[...a[5]||(a[5]=[n("i",{class:"icon-file",style:{"font-size":"48px",color:"#ddd","margin-bottom":"20px"}},null,-1),n("h3",null,"暂无相关新闻",-1),n("p",null,"请尝试其他筛选条件",-1)])],2),a[6]||(a[6]=n("div",{class:"load-more"},[n("button",{class:"load-more-btn",id:"loadMoreBtn"},"加载更多新闻")],-1))]),we.value?(f(),t("div",{key:0,class:"news-modal",onClick:Le},[n("div",{class:"modal-content",onClick:a[2]||(a[2]=h(()=>{},["stop"]))},[n("span",{class:"modal-close",onClick:Le},"×"),n("div",R,[n("div",X,[n("span",Z,g(_e(he.value.date)),1),n("span",ee,g(w(_)(he.value.category)),1),n("span",ae,"作者："+g(he.value.author),1)]),n("h2",se,g(he.value.title),1)]),n("div",le,[n("picture",null,[n("source",{srcset:Ie(he.value.image),type:"image/webp",id:"modalImageWebp"},null,8,te),n("source",{srcset:w(k)(he.value.image),type:"image/png",id:"modalImagePng"},null,8,oe),n("img",{src:w(k)(he.value.image),alt:he.value.title,class:"modal-image",id:"modalImage",loading:"lazy",decoding:"async",fetchpriority:"low",sizes:"(max-width: 768px) 90vw, 800px"},null,8,ne)]),n("div",{class:"modal-content-text",innerHTML:he.value.content},null,8,ie)])])])):i("",!0),o(C)]))}},[["__scopeId","data-v-0fa8e42c"]]);export{ce as default};
